#!/usr/bin/env lua
--/bin/nano: an alternative to program a good text editor.

if os.loadAPI("/lib/debug_manager") then
    debug = _G["debug_manager"]
    debug.debug_write("debug: loaded", false)
else
    debug = {}
    debug.debug_write = print
    debug.debug_write("debug: not loaded")
end

_handler = {}
_handler.signal_handler = function (sig)
    if sig == 'kill' then
        debug.debug_write("nano: SIGKILL'd!", false)
        return 0
    end
end

function main(args)
    local file = args[1]
    local _h = fs.open("/tmp/current_path", 'r')
    local current_path = _h.readAll()
    _h.close()

    if file[1] == '/' then
        if fs.exists(file) then
            local h = fs.open(file, 'a')
        else
            local h = fs.open(file, 'w')
        end
    else
        if fs.exists(fs.combine(current_path, file)) then
            local h = fs.open(fs.combine(current_path, file), 'a')
        else
            local h = fs.open(fs.combine(current_path, file), 'w')
        end
    end
end
