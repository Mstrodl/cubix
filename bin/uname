#!/usr/bin/env lua
--/bin/uname: system information

_handler = {}
_handler.signal_handler = function (sig)
    if sig == 'kill' then
        --print("uname: recieved SIGKILL")
        return 0
    end
end

function main(args)
    local argmt = args[1]

    local fpcid = fs.open("/var/pcid", 'r')
    local fversion = fs.open("/proc/version", 'r')
    local fbuilddate = fs.open("/proc/build_date", 'r')
    local PC_ID = fpcid.readAll()
    local VERSION = fversion.readAll()
    local BUILD_DATE = fbuilddate.readAll()
    fpcid.close()
    fversion.close()
    fbuilddate.close()

    function uname(arg)
        args = {0, arg}
        if args == nil then
            return 'Cubix'
        elseif args[2] == '-a' then
            return 'Cubix '..PC_ID..' v'..VERSION..'-ccraft  Cubix '..VERSION..' ('..BUILD_DATE..') x666 GNU/Deusas'
        elseif args[2] == '-s' then
            return 'Cubix'
        elseif args[2] == '-n' then
            return PC_ID
        elseif args[2] == '-r' then
            return VERSION..'-ccraft'
        elseif args[2] == '-v' then
            return 'Cubix '..VERSION..' (2015-08-26)'
        elseif args[2] == '-m' then
            return 'x666'
        elseif args[2] == '-p' then
            return 'unknown'
        elseif args[2] == '-i' then
            return 'unknown'
        elseif args[2] == '-o' then
            return 'GNU/Deusas'
        else
            return 'Cubix'
        end
    end

    print(uname(argmt))
end
