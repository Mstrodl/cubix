#!/usr/bin/env lua
--/bin/ps

_handler = {}
_handler.signal_handler = function(sig)
    if sig == 'kill' then
        os.debug.debug_write("ps: SIGKILL'd!", false)
        return 0
    end
end

function main(args, pipe)
    p = os.processes
    os.pprint("PID  PROCESS", pipe)
    for k,v in pairs(p) do
        if v ~= -1 then
            if v.parent == nil then
                os.pprint(k.."   "..(v.file .. ' ' .. v.lineargs), pipe)
            else
                if v.parent ~= '/sbin/init' then
                    os.pprint(k.."   "..(v.parent).." > " .. (v.file .. ' ' .. v.lineargs), pipe)
                else
                    os.pprint(k.."   "..(v.file .. ' ' .. v.lineargs), pipe)
                end
            end
        end
    end
end
