#!/usr/bin/env lua
--/bin/ps

_handler = {}
_handler.signal_handler = function(sig)
    if sig == 'kill' then
        os.debug.debug_write("ps: SIGKILL'd!", false)
        return 0
    end
end

function isin(inputstr, wantstr)
    for i = 1, #inputstr do
        local v = string.sub(inputstr, i, i)
        if v == wantstr then return true end
    end
    return false
end

function main(args, pipe)
    --TODO: get process from all terminals
    --TODO: get progress of one tty
    if #args > 1 then
        if isin(args[1], 'a') then
            flag_all_terminals = true
        elseif isin(args[1], 'x') then
            flag_all_proc = true
        end
    end
    p = os.lib.proc.get_processes()
    os.pprint("PID  PROCESS", pipe)
    for k,v in pairs(p) do
        if v ~= -1 then
            if v.parent == nil then
                os.pprint(k.."   "..(v.file .. ' ' .. v.lineargs), pipe)
            else
                if v.parent ~= '/sbin/init' then
                    os.pprint(k.."   "..(v.parent).." > " .. (v.file .. ' ' .. v.lineargs), pipe)
                else
                    os.pprint(k.."   "..(v.file .. ' ' .. v.lineargs), pipe)
                end
            end
        end
    end
end

main({...})
