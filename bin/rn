#!/usr/bin/env lua
--/bin/rn: rename (only files)

_handler = {}
_handler.signal_handler = function (sig)
    if sig == 'kill' then
        --print("rn: SIGKILL'd!")
        return 0
    end
end

function _rename(from, to)
    local hfrom = fs.open(from, 'r')
    local hto = fs.open(to, 'w')
    hto.write(hfrom.readAll())
    hfrom.close()
    hto.close()
    fs.delete(from)
end

function main(args)
    local from, to = args[1], args[2]
    local _h = fs.open("/tmp/current_path", 'r')
    local current_path = _h.readAll()
    _h.close()
    function _combine(c) return fs.combine(current_path, c) end
    function check_slash(s) return string.sub(s, 0, 1) == '/' end
    if from == nil or to == nil then
        print("usage: rn from to")
    else
        if fs.exists(_combine(from)) and not fs.exists(_combine(to)) then
            _rename(_combine(from), _combine(to))
        elseif fs.exists(_combine(from)) and check_slash(to) then
            _rename(_combine(from), to)
        elseif fs.exists(_combine(to)) and check_slash(from) then
            _rename(from,_combine(to))
        elseif check_slash(from) and check_slash(to) then
            _rename(from, to)
        else
            print("rn: check command syntax")
        end
    end
end

